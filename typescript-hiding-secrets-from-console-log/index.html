<!DOCTYPE html>
<html lang="en">

<head>
    <title>Hiding secrets from console.log (and other loggers) | arkus on the net</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://blog.arkusonthe.net/style.css">
    <link rel="stylesheet" href="https://blog.arkusonthe.net/color/green.css">

        <link rel="stylesheet" href="https://blog.arkusonthe.net/color/background_pink.css">
    
    <link rel="stylesheet" href="https://blog.arkusonthe.net/font-hack-subset.css">

        <link rel="shortcut icon" type="image/png" href="/favicon.png">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://blog.arkusonthe.net" style="text-decoration: none;">
                    <div class="logo">
                      
                            arkus on the net
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://blog.arkusonthe.net">blog</a></li>
            
                <li><a href="https://blog.arkusonthe.net/tags">tags</a></li>
            
                <li><a href="https://blog.arkusonthe.net/archive">archive</a></li>
            
                <li><a href="https://blog.arkusonthe.net/about">about me</a></li>
            
                <li><a href="https://github.com/arkus7" target="_blank" rel="noopener noreferrer">github</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://blog.arkusonthe.net/typescript-hiding-secrets-from-console-log/">Hiding secrets from console.log (and other loggers)</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2023-07-09
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://blog.arkusonthe.net/tags/node-js/">#Node.js</a>&nbsp;
                <a class="post-tag" href="https://blog.arkusonthe.net/tags/typescript/">#TypeScript</a>&nbsp;
                <a class="post-tag" href="https://blog.arkusonthe.net/tags/security/">#security</a></span>
    

        
        <div class="post-content">
            <p>How many times have you found sensitive information in the logs (like <code>console.log</code> call or actual log files from <code>winston</code> or <code>pino</code>)?
Have you ever come across sensitive information such as a user's plain-text password or a database connection string in the logs?</p>
<p>It's very common for Node.js developers to use <code>console.log()</code> as a debugging method. It's easy to add a bunch of <code>console.log</code> statements in your code to see how values of variables change. Unfortunately, it's also common that these logs stay in the codebase, potentially logging things that shouldn't be logged at all.</p>
<p>In this post, I'd like to show you how you can hide sensitive data (like secrets or user passwords) from being logged, whether it's <code>console.log</code> (and its siblings i.e. <code>console.warn</code> or <code>console.error</code>) or any other logger commonly used in Node.js ecosystem.</p>
<span id="continue-reading"></span><h1 id="user-password-example">User password example</h1>
<p>Instead of jumping right to the solution, let's work on an example, so you can understand what's going on. We'll use the user password as example of something that we shouldn't log.</p>
<p>Assume we are building a backend application where user can create an account. For that they need to pass in their email and password. The snippet below shows the DTO<sup class="footnote-reference"><a href="#dto">1</a></sup> that corresponds to the request body of registration endpoint.</p>
<pre data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#cd74e8;">interface </span><span style="color:#abb2bf;">CreateUserDto {
</span><span style="color:#abb2bf;">  </span><span style="color:#eb6772;">email</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">string;
</span><span style="color:#abb2bf;">  </span><span style="color:#eb6772;">password</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">string;
</span><span style="color:#abb2bf;">}
</span></code></pre>
<p>We also have a function (a request handler) that receives the data from the client - the email and password of the user to register.</p>
<pre data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#cd74e8;">function </span><span style="color:#5cb3fa;">registerUser</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">CreateUserDto) {
</span><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// implementation added later
</span><span style="color:#abb2bf;">}
</span></code></pre>
<p>and a function that operates on the database and creates actual user record in the database</p>
<pre data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#cd74e8;">function </span><span style="color:#5cb3fa;">createUserRecord</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">data</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">{ </span><span style="color:#eb6772;">email</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">string; </span><span style="color:#eb6772;">password</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">string }) {
</span><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// implementation not important
</span><span style="color:#abb2bf;">}
</span></code></pre>
<h2 id="what-could-go-wrong">What could go wrong?</h2>
<p>In order to see whether our solution works, we need to set up &quot;tests&quot;. In this case, the tests would be different calls to log the incoming data, so that we know that we are covering all cases.</p>
<p>Let's assume the implementation of <code>registerUser</code> function looks like this:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">function </span><span style="color:#5cb3fa;">registerUser</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">CreateUserDto) {
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// do something with payload, e.g. store in database
</span></td></tr><tr><td>3</td><td><span style="color:#abb2bf;">  </span><span style="color:#5cb3fa;">createUserRecord</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// debugging log in the wild
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">6</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;payload:&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">);
</span></mark></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>8</td><td><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// imagine payload is returned back as JSON
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">9</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;stringified payload:&#39;</span><span style="color:#abb2bf;">, JSON.</span><span style="color:#5ebfcc;">stringify</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">));
</span></mark></td></tr><tr><td>10</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>11</td><td><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// try to log password
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">12</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;console.log password:&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">password</span><span style="color:#abb2bf;">);
</span></mark></td></tr><tr><td>13</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>14</td><td><span style="color:#abb2bf;">  </span><span style="font-style:italic;color:#5f697a;">// try to log password as string
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">15</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;password.toString():&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">password</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#abb2bf;">());
</span></mark></td></tr><tr><td>16</td><td><span style="color:#abb2bf;">}
</span></td></tr></tbody></table></code></pre>
<p>The snippet above logs the <code>payload</code> or <code>payload.password</code> in four ways:</p>
<ol>
<li>Log whole <code>payload</code> object on line 6</li>
<li>Log <code>payload</code> object as JSON (using <code>JSON.stringify</code><sup class="footnote-reference"><a href="#stringify">2</a></sup>) on line 9</li>
<li>Log only <code>payload.password</code> on line 12</li>
<li>Log only <code>payload.password</code> as string (using <code>.toString()</code> method available on every object in JS) on line 15</li>
</ol>
<blockquote>
<p>The list might give you some hints of what to expect next but wait till the end, it might suprise you</p>
</blockquote>
<p>This implementation will remain the same for the rest of the post (almost 😉, I'll higlight when it changes).</p>
<p>When called like this:</p>
<pre data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">payload</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">CreateUserDto </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span><span style="color:#abb2bf;">  email: </span><span style="color:#9acc76;">&#39;test@gmail.com&#39;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">  password: </span><span style="color:#9acc76;">&#39;my-secret-password&#39;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">};
</span><span style="color:#abb2bf;">
</span><span style="color:#5cb3fa;">registerUser</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">);
</span></code></pre>
<p>Calling the function results in the following logs:</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">[LOG]: &quot;payload:&quot;,  {
</span><span style="color:#abb2bf;">  &quot;email&quot;: &quot;test@gmail.com&quot;,
</span><span style="color:#abb2bf;">  &quot;password&quot;: &quot;my-secret-password&quot;
</span><span style="color:#abb2bf;">}
</span><span style="color:#abb2bf;">[LOG]: &quot;stringified payload:&quot;,  &quot;{&quot;email&quot;:&quot;test@gmail.com&quot;,&quot;password&quot;:&quot;my-secret-password&quot;}&quot;
</span><span style="color:#abb2bf;">[LOG]: &quot;console.log password:&quot;,  &quot;my-secret-password&quot;
</span><span style="color:#abb2bf;">[LOG]: &quot;password.toString():&quot;,  &quot;my-secret-password&quot;
</span></code></pre>
<p>Oof, so many secrets exposed!</p>
<h1 id="exploring-solution">Exploring solution</h1>
<p>Now that we have set up the example, let's try to hide the user password from the <code>console.log</code> calls.</p>
<h2 id="create-custom-class-for-password">Create custom class for password</h2>
<p>First thing we want to do is to wrap the password (of type <code>string</code>) into it's own type. We can achieve this pretty easily by creating a <code>Password</code> class:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">Password </span><span style="color:#adb7c9;">{
</span></td></tr><tr><td>2</td><td><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#cd74e8;">private readonly </span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">: string) {}
</span></td></tr><tr><td>3</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>4</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">expose</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>6</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>7</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>This way we can have a better control of what the developer can do with our <code>Password</code> class.</p>
<blockquote>
<p>This is called a &quot;newtype&quot; pattern - we wrap a primitive type (in this case a <code>string</code>) into it's own class so we can define a behaviour for it and also differentiate it from regular strings</p>
</blockquote>
<p>We made the <code>plain</code> property private, so that no one else can read it, but made it available through special <code>expose()</code> function.</p>
<blockquote>
<p>You may ask, why <code>expose()</code> and not something like <code>value()</code> or any other <code>get</code>-like name? To make the developers using it consider whether they really want to <strong>expose</strong> the secret underneath.</p>
<p>It might sound silly but it does stop you for a second, plus it's easily noticeable during code reviews!</p>
</blockquote>
<p>Ok, we have a class, but it's unused. Let's refactor our DTO to use the new <code>Password</code> class:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">interface </span><span style="color:#abb2bf;">CreateUserDto {
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">  </span><span style="color:#eb6772;">email</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">string;
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">3</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  </span><span style="color:#eb6772;">password</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">Password;
</span></mark></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">}
</span></td></tr></tbody></table></code></pre>
<p>We also need to adjust the <code>registerUser</code> function to use <code>password.expose()</code> - we need an inner type for call to <code>createUserRecord</code> on line 2.</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">function </span><span style="color:#5cb3fa;">registerUser</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">CreateUserDto) {
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">2</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  </span><span style="color:#5cb3fa;">createUserRecord</span><span style="color:#abb2bf;">({ </span><span style="color:#adb7c9;">...</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">, password: </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">password</span><span style="color:#abb2bf;">.</span><span style="color:#5cb3fa;">expose</span><span style="color:#abb2bf;">() });
</span></mark></td></tr><tr><td>3</td><td><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;payload:&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;stringified payload:&#39;</span><span style="color:#abb2bf;">, JSON.</span><span style="color:#5ebfcc;">stringify</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">));
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;console.log password:&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">password</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>6</td><td><span style="color:#abb2bf;">  </span><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;password.toString():&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">password</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#abb2bf;">());
</span></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">}
</span></td></tr></tbody></table></code></pre>
<p>When we call the <code>registerUser</code> function with new <code>CreateUserDto</code> like this</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">payload</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">CreateUserDto </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">  email: </span><span style="color:#9acc76;">&#39;test@gmail.com&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">3</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">  password: </span><span style="color:#adb7c9;">new </span><span style="color:#abb2bf;">Password(</span><span style="color:#9acc76;">&#39;my-secret-password&#39;</span><span style="color:#abb2bf;">),
</span></mark></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">};
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>6</td><td><span style="color:#5cb3fa;">registerUser</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">);
</span></td></tr></tbody></table></code></pre>
<p>these are the logs</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">[LOG]: &quot;payload:&quot;,  {
</span><span style="color:#abb2bf;">  &quot;email&quot;: &quot;test@gmail.com&quot;,
</span><span style="color:#abb2bf;">  &quot;password&quot;: {
</span><span style="color:#abb2bf;">    &quot;plain&quot;: &quot;my-secret-password&quot;
</span><span style="color:#abb2bf;">  }
</span><span style="color:#abb2bf;">}
</span><span style="color:#abb2bf;">[LOG]: &quot;stringified payload:&quot;,  &quot;{&quot;email&quot;:&quot;test@gmail.com&quot;,&quot;password&quot;:{&quot;plain&quot;:&quot;my-secret-password&quot;}}&quot;
</span><span style="color:#abb2bf;">[LOG]: &quot;console.log password:&quot;,  Password: {
</span><span style="color:#abb2bf;">  &quot;plain&quot;: &quot;my-secret-password&quot;
</span><span style="color:#abb2bf;">}
</span><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">[LOG]: &quot;password.toString():&quot;,  &quot;[object Object]&quot;
</span></mark></code></pre>
<p>So far, nothing has been fixed... unless we count <code>[object Object]</code> as successfully hidden password 😅</p>
<h2 id="fixing-object-object">Fixing [object Object]</h2>
<p>We have achieved a small victory - the password is not exposed when it's logged with use of <code>toString()</code> method!</p>
<p>Unfortunately, it's not very usable in the long run as it returns <code>[object Object]</code>, plus <code>toString()</code> isn't commonly used when it comes to <code>console.log</code>.</p>
<p>You might be wondering, where does the <code>[object Object]</code> come from? It's default serialization of an object in JavaScript.</p>
<blockquote>
<p>Per specification, <a href="https://tc39.es/ecma262/#sec-object.prototype.tostring">20.1.3.6 Object.prototype.toString()</a>, for a custom class that <strong>does not</strong> implement <code>toString()</code> method, the <code>toString()</code> returns concatenation of <code>[object </code>, parent class name, in our case it's <code>Object</code> and <code>]</code> =&gt; <code>[object Object]</code>.</p>
</blockquote>
<p>Okay, now we know a little bit more about the <code>toString()</code> topic. Fixing it should be easy, we just need to implement our own <code>toString()</code> for our class.</p>
<p>Let's modify it to return something more meaningful than <code>[object Object]</code>!</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">Password </span><span style="color:#adb7c9;">{
</span></td></tr><tr><td>2</td><td><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#cd74e8;">private readonly </span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">: string) {}
</span></td></tr><tr><td>3</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>4</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">expose</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>6</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>7</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">8</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">9</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;[REDACTED PASSWORD]&#39;</span><span style="color:#adb7c9;">;
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">10</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  }
</span></mark></td></tr><tr><td>11</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>Calling the <code>registerUser</code> function now produces logs like this:</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">[LOG]: &quot;payload:&quot;,  {
</span><span style="color:#abb2bf;">  &quot;email&quot;: &quot;test@gmail.com&quot;,
</span><span style="color:#abb2bf;">  &quot;password&quot;: {
</span><span style="color:#abb2bf;">    &quot;plain&quot;: &quot;my-secret-password&quot;
</span><span style="color:#abb2bf;">  }
</span><span style="color:#abb2bf;">}
</span><span style="color:#abb2bf;">[LOG]: &quot;stringified payload:&quot;,  &quot;{&quot;email&quot;:&quot;test@gmail.com&quot;,&quot;password&quot;:{&quot;plain&quot;:&quot;my-secret-password&quot;}}&quot;
</span><span style="color:#abb2bf;">[LOG]: &quot;console.log password:&quot;,  Password: {
</span><span style="color:#abb2bf;">  &quot;plain&quot;: &quot;my-secret-password&quot;
</span><span style="color:#abb2bf;">}
</span><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">[LOG]: &quot;password.toString():&quot;,  &quot;[REDACTED PASSWORD]&quot;
</span></mark></code></pre>
<p>We're are making progress! One of the logs patched, a few more to go.</p>
<h2 id="hiding-secrets-in-json">Hiding secrets in JSON</h2>
<p>Now let's tackle the <code>JSON.stringify</code> log.</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">[LOG]: &quot;stringified payload:&quot;,  &quot;{&quot;email&quot;:&quot;test@gmail.com&quot;,&quot;password&quot;:{&quot;plain&quot;:&quot;my-secret-password&quot;}}&quot;
</span></code></pre>
<p>Based on the log above, we can say that it clearly knows something about private properties in our class - it uses <code>plain</code> property in the output, the same as we have in the class.</p>
<p>When we check the specification <a href="https://tc39.es/ecma262/#sec-serializejsonobject">25.5.2.5 SerializeJSONObject</a>, we can see that for each of properties in object's own properties a <a href="https://tc39.es/ecma262/#sec-serializejsonproperty">25.5.2.2 SerializeJSONProperty</a> algorithm is running, which (similarly to <code>toString</code>) checks whether the object has it's own implementation of <code>toJSON</code> method.</p>
<p>If it's available, then it is being used, otherwise the default algorithm is used which goes through all properties recursively until it reaches any primitive types that is known how to be represented in a JSON.</p>
<p>Therefore, the solution here is to implement <code>toJSON</code> on our <code>Password</code> class. Let's make it simply return the same thing that <code>toString()</code> does to be consistent.</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">Password </span><span style="color:#adb7c9;">{
</span></td></tr><tr><td>2</td><td><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#cd74e8;">private readonly </span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">: string) {}
</span></td></tr><tr><td>3</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>4</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">expose</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>6</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>7</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>8</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>9</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;[REDACTED PASSWORD]&#39;</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>10</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>11</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">12</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toJSON</span><span style="color:#adb7c9;">(): string {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">13</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#adb7c9;">();
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">14</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  }
</span></mark></td></tr><tr><td>15</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<blockquote>
<p>The implementation of <code>toJSON</code> can return any type that is serializable. We return <code>string</code> here, but it could be another object like</p>
<pre data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#abb2bf;">{
</span><span style="color:#abb2bf;">  type: </span><span style="color:#9acc76;">&#39;password&#39;</span><span style="color:#abb2bf;">,
</span><span style="color:#abb2bf;">  value: </span><span style="color:#9acc76;">&#39;[REDACTED PASSWORD]&#39;
</span><span style="color:#abb2bf;">}
</span></code></pre>
</blockquote>
<p>With that implementation, our logs look like this:</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">payload: {
</span><span style="color:#abb2bf;">  email: &#39;test@gmail.com&#39;,
</span><span style="color:#abb2bf;">  password: Password { plain: &#39;my-secret-password&#39; }
</span><span style="color:#abb2bf;">}
</span><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">stringified payload: {&quot;email&quot;:&quot;test@gmail.com&quot;,&quot;password&quot;:&quot;[REDACTED PASSWORD]&quot;}
</span></mark><span style="color:#abb2bf;">console.log password: Password { plain: &#39;my-secret-password&#39; }
</span><span style="color:#abb2bf;">password.toString(): [REDACTED PASSWORD]
</span></code></pre>
<p>Alright, we have successfully fixed the JSON log - it no longer contains our password. As you can see, there is one more issue left to be fixed - the output of <code>console.log()</code>.</p>
<p>Do we have any control over how the <code>console.log</code> prints out objects?
<strong>Fortunately, yes.</strong></p>
<h2 id="handling-console-log-output">Handling console.log output</h2>
<p>The implementation of <code>console.log</code> can vary across different platforms. For instance, it can function differently in browsers, with variations even between Chrome and Firefox, as well as in Node.js.</p>
<p>Why is this relevant here? Thanks to this, the Node.js gives us some room for customizing how objects in our code are displayed with <code>console.log</code>. Let's find out how we can do this.</p>
<p>Upon examining the <a href="https://nodejs.org/api/console.html#consolelogdata-args"><code>console.log</code> documentation</a> for Node.js, we find that all parameters passed to <code>console.log</code> are passed to <a href="https://nodejs.org/api/util.html#utilformatformat-args"><code>util.format</code> function</a>.</p>
<p>If we dive deep enough into Node.js source code, we can see that <a href="https://github.com/nodejs/node/blob/38dee8a1c04237bd231a01410f42e9d172f4c162/lib/internal/util/inspect.js#L2178"><code>util.format()</code> uses <code>util.inspect()</code> under the hood</a> with various options, depending on the format and type of the object being formatted.</p>
<p>We should check how the <code>util.inspect</code> works then!</p>
<h3 id="what-is-util-inspect">What is util.inspect?</h3>
<p>In Node.js, the <code>util.inspect</code> function serves as a powerful utility for converting JavaScript objects into strings. It provides a way to inspect and represent objects in a human-readable format, which can be useful for debugging, logging and other purposes.</p>
<p>Let's take a look on a basic usage example:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">import </span><span style="color:#eb6772;">util </span><span style="color:#cd74e8;">from </span><span style="color:#9acc76;">&#39;node:util&#39;</span><span style="color:#abb2bf;">;
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>3</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">obj </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">  name: </span><span style="color:#9acc76;">&#39;John&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">  age: </span><span style="color:#db9d63;">25</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>6</td><td><span style="color:#abb2bf;">  city: </span><span style="color:#9acc76;">&#39;Las Vegas&#39;
</span></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">};
</span></td></tr><tr><td>8</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>9</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">objString </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">util</span><span style="color:#abb2bf;">.</span><span style="color:#5cb3fa;">inspect</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">obj</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>10</td><td><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">objString</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>11</td><td><span style="font-style:italic;color:#5f697a;">// prints
</span></td></tr><tr><td>12</td><td><span style="font-style:italic;color:#5f697a;">// { name: &#39;John&#39;, age: 25, city: &#39;Las Vegas&#39; }
</span></td></tr></tbody></table></code></pre>
<p>It seem to return a JSON representation of the object, so, how is it different from <code>JSON.stringify</code>?</p>
<p>Notice the lack of quotes around the names of the properties - it's not a valid JSON, it's more like you'd put it in the code.</p>
<p>It does handle some cases differently, e.g. circular references:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">import </span><span style="color:#eb6772;">util </span><span style="color:#cd74e8;">from </span><span style="color:#9acc76;">&#39;node:util&#39;</span><span style="color:#abb2bf;">;
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>3</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">obj </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">  name: </span><span style="color:#9acc76;">&#39;John&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">  age: </span><span style="color:#db9d63;">25</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>6</td><td><span style="color:#abb2bf;">  city: </span><span style="color:#9acc76;">&#39;Las Vegas&#39;
</span></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">};
</span></td></tr><tr><td>8</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>9</td><td><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">obj </span><span style="color:#cd74e8;">as </span><span style="color:#abb2bf;">any).</span><span style="color:#eb6772;">selfReference </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">obj</span><span style="color:#abb2bf;">;
</span></td></tr><tr><td>10</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>11</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">objString </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">util</span><span style="color:#abb2bf;">.</span><span style="color:#5cb3fa;">inspect</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">obj</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>12</td><td><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">objString</span><span style="color:#abb2bf;">);
</span></td></tr></tbody></table></code></pre>
<p>This prints log like this:</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">&lt;ref *1&gt; {
</span><span style="color:#abb2bf;">  name: &#39;John&#39;,
</span><span style="color:#abb2bf;">  age: 25,
</span><span style="color:#abb2bf;">  city: &#39;Las Vegas&#39;,
</span><span style="color:#abb2bf;">  selfReference: [Circular *1]
</span><span style="color:#abb2bf;">}
</span></code></pre>
<p>where trying to <code>JSON.stringify</code> such object results in an error</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">TypeError: Converting circular structure to JSON
</span><span style="color:#abb2bf;">    --&gt; starting at object with constructor &#39;Object&#39;
</span><span style="color:#abb2bf;">    --- property &#39;selfReference&#39; closes the circle
</span><span style="color:#abb2bf;">    at JSON.stringify (&lt;anonymous&gt;)
</span></code></pre>
<p><code>util.inspect</code> also accepts an object of options so you can customize the format of the output.</p>
<p>For example, this code will print the colored output (<code>colors: true</code>) on one line (<code>compact: true</code>) with going at most 1 level deep into nested objects (<code>depth: 1</code>).</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">import </span><span style="color:#eb6772;">util </span><span style="color:#cd74e8;">from </span><span style="color:#9acc76;">&#39;node:util&#39;</span><span style="color:#abb2bf;">;
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>3</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">obj </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">  name: </span><span style="color:#9acc76;">&#39;John&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">  age: </span><span style="color:#db9d63;">25</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>6</td><td><span style="color:#abb2bf;">  city: </span><span style="color:#9acc76;">&#39;Las Vegas&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">  object: {
</span></td></tr><tr><td>8</td><td><span style="color:#abb2bf;">    has: {
</span></td></tr><tr><td>9</td><td><span style="color:#abb2bf;">      nested: {
</span></td></tr><tr><td>10</td><td><span style="color:#abb2bf;">        properties: </span><span style="color:#db9d63;">true</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>11</td><td><span style="color:#abb2bf;">      },
</span></td></tr><tr><td>12</td><td><span style="color:#abb2bf;">    },
</span></td></tr><tr><td>13</td><td><span style="color:#abb2bf;">  },
</span></td></tr><tr><td>14</td><td><span style="color:#abb2bf;">};
</span></td></tr><tr><td>15</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">16</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">objString </span><span style="color:#adb7c9;">= </span><span style="color:#eb6772;">util</span><span style="color:#abb2bf;">.</span><span style="color:#5cb3fa;">inspect</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">obj</span><span style="color:#abb2bf;">, { colors: </span><span style="color:#db9d63;">true</span><span style="color:#abb2bf;">, depth: </span><span style="color:#db9d63;">1</span><span style="color:#abb2bf;">, compact: </span><span style="color:#db9d63;">true </span><span style="color:#abb2bf;">});
</span></mark></td></tr><tr><td>17</td><td><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">objString</span><span style="color:#abb2bf;">);
</span></td></tr></tbody></table></code></pre>
<p>Output:</p>
<pre data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><span style="color:#abb2bf;">{ name: </span><span style="color:#9acc76;">&#39;John&#39;</span><span style="color:#abb2bf;">, age: </span><span style="color:#db9d63;">25</span><span style="color:#abb2bf;">, city: </span><span style="color:#9acc76;">&#39;Las Vegas&#39;</span><span style="color:#abb2bf;">, object: { has: [</span><span style="color:#f0c678;">Object</span><span style="color:#abb2bf;">] } }
</span></code></pre>
<p>You can read about other options on the <a href="https://nodejs.org/api/util.html#util_util_inspect_object_options"><code>util.inspect</code> documentation page</a>.</p>
<h3 id="changing-behaviour-of-util-inspect-for-our-class">Changing behaviour of <code>util.inspect</code> for our class</h3>
<p>The Node.js team prepared a way for the users of their runtime to customize the behaviour of <code>util.inspect</code> by adding a special function to the objects.</p>
<p>The function should use <code>util.inspect.custom</code> symbol<sup class="footnote-reference"><a href="#js-symbols">3</a></sup> that is registered globally and can be accessed through either <code>Symbol.for('nodejs.util.inspect.custom')</code> or by importing <code>util</code> from <code>node:util</code> package and using it like so: <code>util.inspect.custom</code>.</p>
<blockquote>
<p>While writing this post, I've found that Node.js documentation has <a href="https://nodejs.org/api/util.html#utilinspectcustom">a similar example</a> of using <code>util.inspect.custom</code> for omitting the value of <code>Password</code> class.
Great minds think alike? 😉</p>
</blockquote>
<p>Let's add that to our <code>Password</code> class and see what happens. We'll make the <code>util.inspect</code> to return (again) the same thing as <code>toString()</code> does.</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td><mark style="background-color:#8cc2fc0b;">1</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">import </span><span style="color:#eb6772;">util </span><span style="color:#cd74e8;">from </span><span style="color:#9acc76;">&#39;node:util&#39;</span><span style="color:#abb2bf;">;
</span></mark></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>3</td><td><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">Password </span><span style="color:#adb7c9;">{
</span></td></tr><tr><td>4</td><td><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#cd74e8;">private readonly </span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">: string) {}
</span></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>6</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">expose</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>7</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>8</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>9</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>10</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>11</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;*** Redacted password ***&#39;</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>12</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>13</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>14</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toJSON</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>15</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#adb7c9;">();
</span></td></tr><tr><td>16</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>17</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">18</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  [</span><span style="color:#eb6772;">util</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">inspect</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">custom</span><span style="color:#adb7c9;">](): string {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">19</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">`&#39;${</span><span style="color:#eb6772;">this</span><span style="color:#9acc76;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#9acc76;">()}&#39;`</span><span style="color:#adb7c9;">;
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">20</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  }
</span></mark></td></tr><tr><td>21</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>Let's take a look into the logs after we have the custom implementation for <code>util.inspect</code></p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">payload</span><span style="color:#adb7c9;">: </span><span style="color:#abb2bf;">CreateUserDto </span><span style="color:#adb7c9;">= </span><span style="color:#abb2bf;">{
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">  email: </span><span style="color:#9acc76;">&#39;test@gmail.com&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>3</td><td><span style="color:#abb2bf;">  password: </span><span style="color:#adb7c9;">new </span><span style="color:#abb2bf;">Password(</span><span style="color:#9acc76;">&#39;my-secret-password&#39;</span><span style="color:#abb2bf;">),
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">};
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>6</td><td><span style="color:#5cb3fa;">registerUser</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>8</td><td><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#9acc76;">&#39;util.inspect:&#39;</span><span style="color:#abb2bf;">, </span><span style="color:#eb6772;">util</span><span style="color:#abb2bf;">.</span><span style="color:#5cb3fa;">inspect</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">payload</span><span style="color:#abb2bf;">));
</span></td></tr></tbody></table></code></pre>
<p>Output:</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">payload: { email: &#39;test@gmail.com&#39;, password: &#39;[REDACTED PASSWORD]&#39; }
</span></mark><span style="color:#abb2bf;">stringified payload: {&quot;email&quot;:&quot;test@gmail.com&quot;,&quot;password&quot;:&quot;[REDACTED PASSWORD]&quot;}
</span><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">console.log password: &#39;[REDACTED PASSWORD]&#39;
</span></mark><span style="color:#abb2bf;">password.toString(): [REDACTED PASSWORD]
</span><mark style="background-color:#8cc2fc0b;"><span style="color:#abb2bf;">util.inspect: { email: &#39;test@gmail.com&#39;, password: &#39;[REDACTED PASSWORD]&#39; }
</span></mark></code></pre>
<blockquote>
<p>I've wrapped the results of <code>toString()</code> method with apostrophes (<code>'</code>). This is not required, I just like the output this way better as it clearly shows that type of value in <code>password</code> field is indeed a <code>string</code> compared with implementation like this:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>18</td><td><span style="color:#abb2bf;">  [</span><span style="color:#eb6772;">util</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">inspect</span><span style="color:#abb2bf;">.</span><span style="color:#eb6772;">custom</span><span style="color:#abb2bf;">](): </span><span style="color:#eb6772;">string </span><span style="color:#abb2bf;">{
</span></td></tr><tr><td>19</td><td><span style="color:#abb2bf;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#abb2bf;">();
</span></td></tr><tr><td>20</td><td><span style="color:#abb2bf;">  }
</span></td></tr></tbody></table></code></pre>
<p>And output</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">util.inspect: { email: &#39;test@gmail.com&#39;, password: [REDACTED PASSWORD] }
</span></code></pre>
<p>As mentioned above, this is just a personal preference.</p>
</blockquote>
<p><strong>We achieved our goal!</strong> We successfully hidden the password from various methods of logging in Node.js.</p>
<h1 id="extra-making-it-more-generic">Extra: Making it more generic</h1>
<p>The class we created above works great, but what if we have more sensitive data to keep out of logs than just a password? Copy-pasting the code for each data type we want to hide will be cumbersome.
Imagine we would like to change the common behavious (e.g. use some additional options in out <code>util.inspect.custom</code> function) - so many places to refactor!</p>
<h2 id="abstract-class">Abstract class</h2>
<p>We can use OOP functionalities of JS/TS and create a base class for other types to extend! Let's call it <code>Secret</code> to be less associated with password.</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td>1</td><td><span style="color:#cd74e8;">import </span><span style="color:#eb6772;">util </span><span style="color:#cd74e8;">from </span><span style="color:#9acc76;">&#39;node:util&#39;</span><span style="color:#abb2bf;">;
</span></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">3</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">abstract class </span><span style="color:#f0c678;">Secret </span><span style="color:#adb7c9;">{
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">4</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#cd74e8;">protected readonly </span><span style="color:#eb6772;">data</span><span style="color:#adb7c9;">: string) {}
</span></mark></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">6</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">exposeSecret</span><span style="color:#adb7c9;">(): string {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">7</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.data;
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">8</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  }
</span></mark></td></tr><tr><td>9</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>10</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>11</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;[REDACTED]&#39;</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>12</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>13</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>14</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toJSON</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>15</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#adb7c9;">();
</span></td></tr><tr><td>16</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>17</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>18</td><td><span style="color:#adb7c9;">  [</span><span style="color:#eb6772;">util</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">inspect</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">custom</span><span style="color:#adb7c9;">](): string {
</span></td></tr><tr><td>19</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">`&#39;${</span><span style="color:#eb6772;">this</span><span style="color:#9acc76;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#9acc76;">()}&#39;`</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>20</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>21</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>We created an abstract class<sup class="footnote-reference"><a href="#abstract-class">4</a></sup> <code>Secret</code> which is almost 1:1 copy of our <code>Password</code> class from examples above. The only differences are:</p>
<ul>
<li>we have a <code>data</code> property instead of <code>plain</code> property</li>
<li>the <code>expose()</code> method is renamed to <code>exposeSecret()</code></li>
</ul>
<p>Now we can refactor our <code>Password</code> class to extend the <code>Secret</code> class</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td><mark style="background-color:#8cc2fc0b;">1</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">Password </span><span style="color:#cd74e8;">extends </span><span style="color:#9acc76;">Secret </span><span style="color:#adb7c9;">{
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">2</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">: string) {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">3</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">    </span><span style="color:#eb6772;">super</span><span style="color:#adb7c9;">(</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">);
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">4</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  }
</span></mark></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">6</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">7</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;[REDACTED PASSWORD]&#39;</span><span style="color:#adb7c9;">;
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">8</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  }
</span></mark></td></tr><tr><td>9</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>We had to refactor the constructor a bit - we no longer need to keep the <code>plain</code> password inside our class - <code>Secret</code> does it for us.</p>
<p>Lines 6-8 are not required for <code>Password</code> class to work but overriding the <code>toString()</code> method allows us to be more specific what is being redacted from the logs (by default it would use implementation from <code>Secret</code> which would print <code>[REDACTED]</code>).</p>
<h2 id="supporting-other-data-than-string">Supporting other data than string</h2>
<p>So far our <code>Secret</code> class allows us to store only <code>string</code> values as the secrets. While this is usually the case, maybe we would like sometimes to keep whole object as a secret?</p>
<p>We can make the <code>Secret</code> class generic<sup class="footnote-reference"><a href="#ts-generics">5</a></sup> over the type of <code>data</code> stored inside!</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td><mark style="background-color:#8cc2fc0b;">1</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">abstract class </span><span style="color:#f0c678;">Secret</span><span style="color:#adb7c9;">&lt;T&gt; {
</span></mark></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">2</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#cd74e8;">protected readonly </span><span style="color:#eb6772;">data</span><span style="color:#adb7c9;">: T) {}
</span></mark></td></tr><tr><td>3</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td><mark style="background-color:#8cc2fc0b;">4</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">exposeSecret</span><span style="color:#adb7c9;">(): T {
</span></mark></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.data;
</span></td></tr><tr><td>6</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>7</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>8</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>9</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;[REDACTED]&#39;</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>10</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>11</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>12</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toJSON</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>13</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#eb6772;">this</span><span style="color:#adb7c9;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#adb7c9;">();
</span></td></tr><tr><td>14</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>15</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>16</td><td><span style="color:#adb7c9;">  [</span><span style="color:#eb6772;">util</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">inspect</span><span style="color:#adb7c9;">.</span><span style="color:#eb6772;">custom</span><span style="color:#adb7c9;">](): string {
</span></td></tr><tr><td>17</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">`&#39;${</span><span style="color:#eb6772;">this</span><span style="color:#9acc76;">.</span><span style="color:#5ebfcc;">toString</span><span style="color:#9acc76;">()}&#39;`</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>18</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>19</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>We introduced a type parameter <code>T</code> in our class definition. This allows us to pass any type of data into the <code>Secret</code> class and have it type safe (<code>exposeSecret()</code> on line 4 returns the same type as passed in in constructor).</p>
<p>With this definition of <code>Secret</code> class, our <code>Password</code> class looks like this:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td><mark style="background-color:#8cc2fc0b;">1</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">Password </span><span style="color:#cd74e8;">extends </span><span style="color:#9acc76;">Secret</span><span style="color:#adb7c9;">&lt;string&gt; {
</span></mark></td></tr><tr><td>2</td><td><span style="color:#adb7c9;">  </span><span style="color:#cd74e8;">constructor</span><span style="color:#adb7c9;">(</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">: string) {
</span></td></tr><tr><td>3</td><td><span style="color:#adb7c9;">    </span><span style="color:#eb6772;">super</span><span style="color:#adb7c9;">(</span><span style="color:#eb6772;">plain</span><span style="color:#adb7c9;">);
</span></td></tr><tr><td>4</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>5</td><td><span style="color:#adb7c9;">
</span></td></tr><tr><td>6</td><td><span style="color:#adb7c9;">  </span><span style="color:#5cb3fa;">toString</span><span style="color:#adb7c9;">(): string {
</span></td></tr><tr><td>7</td><td><span style="color:#adb7c9;">    </span><span style="color:#cd74e8;">return </span><span style="color:#9acc76;">&#39;[REDACTED PASSWORD]&#39;</span><span style="color:#adb7c9;">;
</span></td></tr><tr><td>8</td><td><span style="color:#adb7c9;">  }
</span></td></tr><tr><td>9</td><td><span style="color:#adb7c9;">}
</span></td></tr></tbody></table></code></pre>
<p>Now we extend <code>Secret&lt;string&gt;</code> to narrow down what types can be used in the constructor.</p>
<p>We can now easily create another type of secret, like <code>OpenAIConfig</code> for keeping our API keys safe:</p>
<pre data-linenos data-lang="ts" style="background-color:#2b303b;color:#6c7079;" class="language-ts "><code class="language-ts" data-lang="ts"><table><tbody><tr><td><mark style="background-color:#8cc2fc0b;">1</mark></td><td><mark style="background-color:#8cc2fc0b;"><span style="color:#cd74e8;">class </span><span style="color:#f0c678;">OpenAIConfig </span><span style="color:#cd74e8;">extends </span><span style="color:#9acc76;">Secret</span><span style="color:#adb7c9;">&lt;{ </span><span style="color:#eb6772;">key</span><span style="color:#adb7c9;">: string; </span><span style="color:#eb6772;">orgId</span><span style="color:#adb7c9;">: string }&gt; {}
</span></mark></td></tr><tr><td>2</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>3</td><td><span style="color:#cd74e8;">const </span><span style="color:#eb6772;">config </span><span style="color:#adb7c9;">= new </span><span style="color:#abb2bf;">OpenAIConfig({
</span></td></tr><tr><td>4</td><td><span style="color:#abb2bf;">  key: </span><span style="color:#9acc76;">&#39;my-secret-key&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>5</td><td><span style="color:#abb2bf;">  orgId: </span><span style="color:#9acc76;">&#39;my-secret-org-id&#39;</span><span style="color:#abb2bf;">,
</span></td></tr><tr><td>6</td><td><span style="color:#abb2bf;">});
</span></td></tr><tr><td>7</td><td><span style="color:#abb2bf;">
</span></td></tr><tr><td>8</td><td><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">config</span><span style="color:#abb2bf;">);
</span></td></tr><tr><td>9</td><td><span style="color:#f0c678;">console</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">log</span><span style="color:#abb2bf;">(</span><span style="color:#eb6772;">config</span><span style="color:#abb2bf;">.</span><span style="color:#5cb3fa;">exposeSecret</span><span style="color:#abb2bf;">().</span><span style="color:#eb6772;">key</span><span style="color:#abb2bf;">);
</span></td></tr></tbody></table></code></pre>
<p>In this case, our secret <code>data</code> type is <code>{ key: string; orgId: string }</code> passed explicitly on line 1.</p>
<p>If we log the <code>config</code> struct, we see the default <code>[REDACTED]</code> message, unless we call <code>config.exposeSecret()</code> which gives us access to the inner data.</p>
<p>Executing code in the snippet above result in logs like this:</p>
<pre style="background-color:#2b303b;color:#6c7079;"><code><span style="color:#abb2bf;">&#39;[REDACTED]&#39;
</span><span style="color:#abb2bf;">my-secret-key
</span></code></pre>
<h1 id="conclusion">Conclusion</h1>
<p>In this post, we've explored the importance of keeping sensitive information, such as passwords and API keys, hidden from logs in Node.js applications. We've seen how easily such data can be exposed through common debugging practices like using <code>console.log()</code> or other logging libraries.</p>
<p>To tackle this issue, we've introduced the concept of wrapping sensitive data in a custom class, which gives us greater control over how this data is logged. We've created a <code>Password</code> class as an example, which redacts the password when it's logged in various ways.</p>
<p>We've also delved into some of the intricacies of JavaScript and Node.js, such as how <code>console.log()</code>, <code>JSON.stringify()</code>, and <code>util.inspect()</code> handle objects, and how we can customize their behavior by defining methods like <code>toString()</code>, <code>toJSON()</code>, and <code>util.inspect.custom</code> in our classes.</p>
<p>Finally, we've generalized our solution by creating an abstract <code>Secret</code> class that can be used to hide any type of data. This allows us to easily create new types of secrets without duplicating code.</p>
<p>Remember, security is a crucial aspect of software development, and it's our responsibility as developers to protect sensitive data. By being aware of potential pitfalls and knowing how to avoid them, we can make our applications safer and more reliable.</p>
<p>Thank you for reading, and happy coding!</p>
<div class="footnote-definition" id="dto"><sup class="footnote-definition-label">1</sup>
<p>DTO stands for Data Transfer Object. It's a design pattern used in software development that involves creating an object that aggregates and encapsulates data for transfer. They are typically simple, flat objects that contain no business logic but can hold all the data for a specific operation.</p>
</div>
<div class="footnote-definition" id="stringify"><sup class="footnote-definition-label">2</sup>
<p>This is a built-in JavaScript function that converts a JavaScript object into a JSON string. This can be useful for logging or sending data over a network.</p>
</div>
<div class="footnote-definition" id="js-symbols"><sup class="footnote-definition-label">3</sup>
<p>Symbols are a primitive data type in JavaScript that can be used as unique identifiers for object properties. In our case, <code>util.inspect.custom</code> is a symbol that's used to define a custom inspection function for an object. You can read more about <code>Symbol</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">here</a>.</p>
</div>
<div class="footnote-definition" id="abstract-class"><sup class="footnote-definition-label">4</sup>
<p>In object-oriented programming, an abstract class is a class that cannot be instantiated on its own. Instead, you create subclasses that inherit the properties and methods of the abstract class. In our case, Secret is an abstract class that provides a blueprint for creating specific types of secrets.</p>
</div>
<div class="footnote-definition" id="ts-generics"><sup class="footnote-definition-label">5</sup>
<p>Generics are a feature of TypeScript that allows you to create reusable code that can work with different types. In our case, <code>Secret&lt;T&gt;</code> is a generic class that can be used to create secrets of any type.</p>
</div>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Thanks for reading! Read other posts?</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://blog.arkusonthe.net/typescript-exhaustive-switch/">
                            <span class="button__icon">←</span>&nbsp;
                            <span class="button__text">Exhaustive Switch Statements in TypeScript</span>
                        </a>
                    </span>
                
                </div>
        </div>
    
        
  <script src="https://utteranc.es/client.js"
    repo="arkus7&#x2F;arkus7.github.io"
    issue-term="title"
    theme="preferred-color-scheme"
    crossorigin="anonymous"
    async>
  </script>
  
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2023
 Arkadiusz Żmudzin</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
